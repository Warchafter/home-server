# =============================================================================
# Caddyfile - Reverse Proxy Configuration
# =============================================================================
#
# HOW THIS WORKS:
# Caddy listens on ports and routes requests to the correct Docker container.
# Containers are referenced by their container_name (e.g., "uptime-kuma")
# because they share a Docker network with Caddy. Docker's internal DNS
# resolves these names automatically.
#
# CURRENT MODE: Port-based routing (no domain needed)
# Each service gets a unique port on the server's IP.
#
# UPGRADE PATH: When you get a domain, see docs/adding-a-domain.md
#
# RELOADING: After editing this file, reload Caddy without restarting:
#   docker compose exec caddy caddy reload --config /etc/caddy/Caddyfile
# =============================================================================

# ---------------------------------------------------------------------------
# Homepage Dashboard — the landing page
# Access at: http://SERVER_IP (port 80)
# ---------------------------------------------------------------------------
:80 {
	reverse_proxy homepage:3000
}

# ---------------------------------------------------------------------------
# Uptime Kuma — service monitoring
# Access at: http://SERVER_IP:8090
# ---------------------------------------------------------------------------
:8090 {
	reverse_proxy uptime-kuma:3001
}

# ---------------------------------------------------------------------------
# AdGuard Home — DNS admin panel
# Access at: http://SERVER_IP:8091
# Note: DNS itself runs on port 53 (separate from this web UI)
# ---------------------------------------------------------------------------
:8091 {
	reverse_proxy adguard:80
}

# ---------------------------------------------------------------------------
# Vaultwarden — password manager
# Access at: https://SERVER_IP:8092
# Uses a self-signed cert (tls internal) because Vaultwarden's web vault
# requires a secure context (HTTPS) for the Web Crypto API.
# Your browser will warn once about the untrusted cert — accept it.
# ---------------------------------------------------------------------------
{$SERVER_IP}:8092 {
	tls internal
	reverse_proxy vaultwarden:80
}

# ---------------------------------------------------------------------------
# Jellyfin — media server
# Access at: http://SERVER_IP:8093
# ---------------------------------------------------------------------------
:8093 {
	reverse_proxy jellyfin:8096
}

# ---------------------------------------------------------------------------
# Sonarr — TV show management
# Access at: http://SERVER_IP:8094
# ---------------------------------------------------------------------------
:8094 {
	reverse_proxy sonarr:8989
}

# ---------------------------------------------------------------------------
# Radarr — movie management
# Access at: http://SERVER_IP:8095
# ---------------------------------------------------------------------------
:8095 {
	reverse_proxy radarr:7878
}

# ---------------------------------------------------------------------------
# Prowlarr — indexer manager
# Access at: http://SERVER_IP:8096
# ---------------------------------------------------------------------------
:8096 {
	reverse_proxy prowlarr:9696
}

# ---------------------------------------------------------------------------
# qBittorrent — download client
# Access at: http://SERVER_IP:8097
# ---------------------------------------------------------------------------
:8097 {
	reverse_proxy qbittorrent:8080
}

# ---------------------------------------------------------------------------
# Home Assistant — smart home automation
# Access at: http://SERVER_IP:8098
# NOTE: If you switch HA to network_mode: host, change the target to
# SERVER_IP:8123 (the container name won't resolve on host networking).
# ---------------------------------------------------------------------------
:8098 {
	reverse_proxy homeassistant:8123
}

# ---------------------------------------------------------------------------
# Syncthing — file synchronization
# Access at: http://SERVER_IP:8099
# ---------------------------------------------------------------------------
:8099 {
	reverse_proxy syncthing:8384
}

# =============================================================================
# DOMAIN MODE (uncomment when you have a domain)
# See docs/adding-a-domain.md for step-by-step instructions.
#
# WARNING: You must comment out ALL port-based blocks above before
# uncommenting the domain blocks below. Running both simultaneously
# will cause routing conflicts.
#
# Also uncomment the 'environment' block in stacks/caddy.yaml to pass
# DOMAIN and ACME_EMAIL to the container.
# =============================================================================
#
# {
#     # Global options — your email for Let's Encrypt notifications
#     email {env.ACME_EMAIL}
# }
#
# dashboard.home.{env.DOMAIN} {
#     reverse_proxy homepage:3000
# }
#
# status.home.{env.DOMAIN} {
#     reverse_proxy uptime-kuma:3001
# }
#
# adguard.home.{env.DOMAIN} {
#     reverse_proxy adguard:80
# }
#
# vault.home.{env.DOMAIN} {
#     reverse_proxy vaultwarden:80
# }
#
# media.home.{env.DOMAIN} {
#     reverse_proxy jellyfin:8096
# }
#
# sonarr.home.{env.DOMAIN} {
#     reverse_proxy sonarr:8989
# }
#
# radarr.home.{env.DOMAIN} {
#     reverse_proxy radarr:7878
# }
#
# prowlarr.home.{env.DOMAIN} {
#     reverse_proxy prowlarr:9696
# }
#
# qbit.home.{env.DOMAIN} {
#     reverse_proxy qbittorrent:8080
# }
#
# ha.home.{env.DOMAIN} {
#     reverse_proxy homeassistant:8123
# }
#
# sync.home.{env.DOMAIN} {
#     reverse_proxy syncthing:8384
# }
